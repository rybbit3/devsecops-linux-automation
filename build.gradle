plugins {
    id 'java'
    id 'jacoco' // 1. JaCoCo í”ŒëŸ¬ê·¸ì¸ ì ìš©
    id 'org.sonarqube' version '5.0.0.4638' // 2. SonarQube í”ŒëŸ¬ê·¸ì¸ ì ìš©
}

group = 'com.example'
version = '0.0.1-SNAPSHOT'

// ğŸš¨ ìˆ˜ì • 1: 'sourceCompatibility'ëŠ” 'java' ë¸”ë¡ ì•ˆì— ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
java {
    sourceCompatibility = '17'
}

repositories {
    mavenCentral()
}

// ğŸš¨ ìˆ˜ì • 2: JUnit 5 ì‹¤í–‰ì„ ìœ„í•œ ì˜ì¡´ì„±ìœ¼ë¡œ ë³€ê²½
dependencies {
    // JUnit BOM(Bill of Materials)ìœ¼ë¡œ ë²„ì „ ê´€ë¦¬
    testImplementation platform('org.junit:junit-bom:5.10.0')

    // í…ŒìŠ¤íŠ¸ ì‘ì„±ì— í•„ìš”í•œ API
    testImplementation 'org.junit.jupiter:junit-jupiter'

    // (ê°€ì¥ ì¤‘ìš”) í…ŒìŠ¤íŠ¸ ì‹¤í–‰ì„ ìœ„í•œ Launcher (ì´ì „ ë¹Œë“œ ì‹¤íŒ¨ ì›ì¸)
    testRuntimeOnly 'org.junit.platform:junit-platform-launcher'
    
    // (ê¶Œì¥) í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì—”ì§„
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine'
}

test {
    useJUnitPlatform()
    // 3. 'test' íƒœìŠ¤í¬ê°€ ëë‚˜ë©´ JaCoCo ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•˜ë„ë¡ ì„¤ì •
    finalizedBy jacocoTestReport
}

jacocoTestReport {
    dependsOn test // jacocoTestReportëŠ” test íƒœìŠ¤í¬ì— ì˜ì¡´
    reports {
        // 4. SonarQubeê°€ ì½ì„ XML ë¦¬í¬íŠ¸ ìƒì„±
        xml.required = true
        // (ì„ íƒ) ì‚¬ëŒì´ ë³¼ HTML ë¦¬í¬íŠ¸ë„ ìƒì„±
        html.required = true
    }
}

sonar {
    properties {
        // 5. ì‚¬ìš©ì ê°’ ì ìš© (ìˆ˜ì • ì™„ë£Œ)
        property "sonar.projectKey", "rybbit3" 
        property "sonar.organization", "rybbit3" 
        property "sonar.host.url", "https://sonarcloud.io"

        // 6. SonarQubeì—ê²Œ JaCoCo ë¦¬í¬íŠ¸ íŒŒì¼ì˜ ìœ„ì¹˜ë¥¼ ì•Œë ¤ì¤Œ (í•µì‹¬!)
        property "sonar.coverage.jacoco.xmlReportPaths", "${build.buildDir}/reports/jacoco/test/jacocoTestReport.xml"
    }
}